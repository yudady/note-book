# myPay在线支付（回調通知）v1.0



## 需求
1. myPay前台通信
2. myPay後台任務發起者
3. myPayCenter工作執行者(以後只更新這邊)


## 即時回調通知流程
```
1. myPayCenter收到第三方回調，通知myPay後台，產生一筆job
```

## 定時回調通知流程
```
1. job tasks（定時任務，發起者）myPay後台 -> 送order_no 到 myPayCenter
2. myPayCenter收到order_no開始產生返回資訊，組成json_data，json_data返回myPay後台
3. myPay後台收到json_data，把json_data送到myPay前台
4. myPay前台把訊息送到客戶端（通知客戶收到金額《客戶端callback》），成功前台收到success，回寫DB
```

## 手動回調通知流程
```
1. 客戶點擊手動回調BTN
2. 添加一筆任務到myPay後台的job tasks
3. 開始執行->"回調通知流程"
```

## 記錄流程狀態改變
每個流程需要更新DB.status，並記錄LOG.table



## json_data 格式
```
myPay前台需要解析的格式，然后送单到客户端
{
    version : 'v1',
    frontEndAction : ['' , ''],         // 前台需要的额外行为
    backEndAction : ['' , ''],          // 后台需要的额外行为

    url : 'http://og.game.com/callbackurl',
    action : 'post' ,                   // get
    sendFormat : 'json' ,               // xml , form-post .....
    headers : {

    },
    params : {
        orderNo : "orderNo",
        sign : 'sign',
        notifyTime : '20180101010101',
        ......
    }
    
}


```
